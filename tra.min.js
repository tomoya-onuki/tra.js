!function(){"use strict";function t(){return new s}class s{#a=[];#b=0;#c=0;#d=1;#e=[0,0,0];#f;#g=1;#h=!0;#i=0;#j=1;#k=1;#l="";#m={font:"Arial",size:10,color:"#000",offset:0};#n=!0;#o;#p;#q=!1;#r;#s=!1;#t=new tg;#u=[];#v="#000";#w=!1;#x=!0;constructor(){return this}trajectory(t){return this.#a=t,this.#f=t[t.length-1].date-t[0].date,this.#b=t[0].date,this.#c=t[t.length-1].date,this}color(t,s,i){return this.#e=[t,s,i],this}weight(t){return this.#d=t,this}thinning(t){return t>=1&&(t=1),t<0&&(t=0),this.#k=t,this}length(t){return this.#f=t,this}damping(t){return t>=1&&(t=1),t<0&&(t=0),this.#g=t,this}roundCap(t){return this.#h=Boolean(t),this}ticks(t){return this.#i=t,this}opacity(t){return this.#j=t,this}label(t){return this.#l=t,this}labelStyle(t){return this.#m=t,this}canvas(t){return this.#o=t,this.#p=t.getContext("2d"),this.#q=!0,this.#s=!1,this}svg(t){return this.#r=t,this.#q=!1,this.#s=!0,this}draw(...t){if(this.#y(),1===t.length){let s=t[0];this.#z(s)}}#z(i){if(!(this.#a.length<1)&&!(i<this.#b)&&this.#a.length>0){let e=function t(s,i,e,h){if(!(s<=i))return s;{let r=Math.ceil(s+(i-s)/2),l=h[r].date;return l>e?t(s,r-1,e,h):l<e?t(r+1,i,e,h):r}}(0,this.#a.length-1,i,this.#a)-1,h=this.#j,r=this.#d;if(0<=e&&e<this.#a.length-1){let l=this.#a[e].date,a=this.#t.x(this.#a[e].lon),o=this.#t.y(this.#a[e].lat),n=this.#a[e+1].date,c=this.#t.x(this.#a[e+1].lon),d=this.#t.y(this.#a[e+1].lat),g=(i-l)/(n-l),m=(1-g)*a+g*c,p=(1-g)*o+g*d,f=a,$=o,_=i-l;if(_>this.#f){let b=(_-this.#f)/(n-l);f=(1-b)*a+b*c,$=(1-b)*o+b*d}else f=a,$=o;let y=`rgba(${this.#e[0]}, ${this.#e[1]}, ${this.#e[2]}, ${h})`,u=`rgba(${this.#e[0]}, ${this.#e[1]}, ${this.#e[2]}, ${h*=this.#g})`;if(this.#q&&!this.#s){this.#p.beginPath(),this.#p.moveTo(m,p),this.#p.lineTo(f,$),this.#p.lineWidth=r,this.#p.lineCap=this.#h?"round":"butt";let v=y;m||p||f||$||((v=this.#p.createLinearGradient(m,p,f,$)).addColorStop(0,y),v.addColorStop(1,u)),this.#p.strokeStyle=v,this.#p.stroke()}else!this.#q&&this.#s&&this.#r.append("line").attr("x1",m).attr("y1",p).attr("x2",f).attr("y2",$).attr("stroke-width",r).attr("stroke-linecap",this.#h?"round":"butt").attr("stroke",y);let x=this.#c;if(this.#i>0){let S=c-a,w=d-o,k=Math.sqrt(S*S+w*w),j=-w/k*r,L=S/k*r;for(;x>l;){if(x<=i){let T=(x-l)/(n-l),C=(1-(T=Math.round(100*T)/100))*a+T*c,P=(1-T)*o+T*d;this.#q&&!this.#s?(this.#p.beginPath(),this.#p.moveTo(C-j,P-L),this.#p.lineTo(C+j,P+L),this.#p.strokeStyle=`rgba(${this.#e[0]}, ${this.#e[1]}, ${this.#e[2]}, ${h})`,this.#p.lineWidth=1,this.#p.stroke()):!this.#q&&this.#s&&this.#r.append("line").attr("x1",C-j).attr("y1",P-L).attr("x2",C+j).attr("y2",P+L).attr("stroke-width",1).attr("stroke",`rgba(${this.#e[0]}, ${this.#e[1]}, ${this.#e[2]}, ${h})`)}x-=this.#i}}r*=this.#k,this.#f>=_&&this.#A(e-1,h,r,this.#f-_,x,i),this.#l&&(this.#q&&!this.#s?(this.#p.font=`${this.#m.size}pt ${this.#m.font}`,this.#p.fillStyle=this.#m.color,this.#p.fillText(this.#l,m+this.#m.offset,p+this.#m.offset)):!this.#q&&this.#s&&this.#r.append("text").attr("x",m+this.#m.offset).attr("y",p+this.#m.offset).attr("font-family",this.#m.font).attr("font-size",`${this.#m.size}pt`).attr("fill",this.#m.color).text(this.#l))}else{let M=this.#c;e=this.#a.length-2;let A=i-this.#a[e].date;if(h*=this.#g,r*=this.#k,this.#f>=A&&(this.#A(e-1,h,r,this.#f-A,M,i),this.#l)){let E=this.#t.x(this.#a[e].lon),G=this.#t.y(this.#a[e].lat);this.#q&&!this.#s?(this.#p.font=`${this.#m.size}pt ${this.#m.font}`,this.#p.fillStyle=this.#m.color,this.#p.fillText(this.#l,E+this.#m.offset,G+this.#m.offset)):!this.#q&&this.#s&&this.#r.append("text").attr("x",E+this.#m.offset).attr("y",G+this.#m.offset).attr("font-family",this.#m.font).attr("font-size",`${this.#m.size}pt`).attr("fill",this.#m.color).text(this.#l)}}}}#A(z,I,D,W,R,q){if(0<=z){let F=this.#a[z].date,B=this.#t.x(this.#a[z].lon),H=this.#t.y(this.#a[z].lat),J=this.#a[z+1].date,K=this.#t.x(this.#a[z+1].lon),N=this.#t.y(this.#a[z+1].lat),O=K,Q=N,U=B,V=H,X=J-F;if(X>W){let Y=(X-W)/(J-F);U=(1-Y)*B+Y*K,V=(1-Y)*H+Y*N}else U=B,V=H;let Z=`rgba(${this.#e[0]}, ${this.#e[1]}, ${this.#e[2]}, ${I})`,tt=`rgba(${this.#e[0]}, ${this.#e[1]}, ${this.#e[2]}, ${I*=this.#g})`;if(this.#q&&!this.#s){this.#p.beginPath(),this.#p.moveTo(O,Q),this.#p.lineTo(U,V),this.#p.lineWidth=D,this.#p.lineCap=this.#h?"round":"butt";let ts=this.#p.createLinearGradient(O,Q,U,V);ts.addColorStop(0,Z),ts.addColorStop(1,tt),this.#p.strokeStyle=ts,this.#p.stroke()}else!this.#q&&this.#s&&this.#r.append("line").attr("x1",O).attr("y1",Q).attr("x2",U).attr("y2",V).attr("stroke-width",D).attr("stroke-linecap",this.#h?"round":"butt").attr("stroke",Z);let ti=X>W?J-W:F;if(this.#i>0){let te=K-B,th=N-H,tr=Math.sqrt(te*te+th*th),tl=-th/tr*D,ta=te/tr*D;for(;R>ti;){if(R<=q){let to=(R-F)/(J-F),tn=(1-(to=Math.round(100*to)/100))*B+to*K,tc=(1-to)*H+to*N;this.#q&&!this.#s?(this.#p.beginPath(),this.#p.moveTo(tn-tl,tc-ta),this.#p.lineTo(tn+tl,tc+ta),this.#p.lineWidth=1,this.#p.strokeStyle=`rgba(${this.#e[0]}, ${this.#e[1]}, ${this.#e[2]}, ${I})`,this.#p.stroke()):!this.#q&&this.#s&&this.#r.append("line").attr("x1",tn-tl).attr("y1",tc-ta).attr("x2",tn+tl).attr("y2",tc+ta).attr("stroke-width",1).attr("stroke",`rgba(${this.#e[0]}, ${this.#e[1]}, ${this.#e[2]}, ${I})`)}R-=this.#i}}D*=this.#k,W>=X&&this.#A(z-1,I,D,W-X,R,q)}return this}start(){return this.#n=!0,this}pause(){return this.#n=!1,this}animation(t,s,i,e,h){let r=this,l=i,a=setInterval(function(){if(r.#q&&!r.#s){let t=r.#o.width,o=r.#o.height;r.#p.clearRect(0,0,t,o)}else!r.#q&&r.#s&&(r.#r.selectAll("line").remove(),r.#r.selectAll("text").remove());r.#y(),r.#z(l),r.#n&&(l+=s),l>e&&(h?l=i:clearInterval(a))},t);return this}transform(t){return this.#t.scale(t.scale),this.#t.center(t.center.lon,t.center.lat),this.#t.mode(t.projection),this.#q&&!this.#s?(this.#t.h=this.#o.height,this.#t.w=this.#o.width):!this.#q&&this.#s&&(this.#t.h=this.#r.attr("height"),this.#t.w=this.#r.attr("width")),this}map(t){if(this.#q&&!this.#s){let s=new tm;s.topojson(t),this.#u.push(s)}return this}mapStyle(t){return this.#u.forEach(s=>{t.color&&(this.#v=t.color),t.stroke&&(this.#x=t.stroke),t.fill&&(this.#w=t.fill)}),this}#y(){this.#u.length>0&&this.#u.forEach(t=>t.draw(this.#p,this.#t,this.#v,this.#w,this.#x))}}function td(t,s,i,e){return Math.sqrt((i-t)*(i-t)+(e-s)*(e-s))}class tg{#B=0;#C=0;#D=1;#E="liner";h=0;w=0;constructor(){}x(t){return"liner"===this.#E?(t-this.#C)*this.#D+this.w/2:"mercator"===this.#E?(t*(Math.PI/180)-this.#C*(Math.PI/180))*this.#D+this.w/2:0}y(t){if(t*=-1,"liner"===this.#E)return(t-this.#B)*this.#D+this.h/2;if("mercator"===this.#E){let s;return(Math.log(Math.tan(Math.PI/4+t*(Math.PI/180)/2))-Math.log(Math.tan(Math.PI/4+this.#B*(Math.PI/180)/2)))*this.#D+this.h/2}return 0}center(t,s){this.#C=t,this.#B=-s}scale(t){this.#D=t}mode(t){this.#E=t}mercator(){this.#E="mercator"}}class tm{topoGeometrysList=[];constructor(){}topojson(t){let s=JSON.parse(t);Object.keys(s.objects).forEach(t=>{this.topoGeometrysList.push(s.objects[t].geometries)}),this.topoArcList=this.#F(s,s.arcs)}#G(tp,tf){let t$=0,t_=0;return tf.map(t=>{if(t$+=t[0],t_+=t[1],void 0!=tp.transform){let s=t$*tp.transform.scale[0]+tp.transform.translate[0],i=t_*tp.transform.scale[1]+tp.transform.translate[1];return{lon:s,lat:i}}{let e=t$,h=t_;return{lon:e,lat:h}}})}#F(tb,ty){return ty.map(t=>this.#G(tb,t))}draw(t,s,i,e,h){t.fillStyle=i,t.strokeStyle=i,t.lineWidth=1,this.topoGeometrysList.forEach(i=>{this.#y(i,t,s,e,h)})}#y(tu,tv,tx,tS,t9){tu.length>0&&tu.forEach(t=>{if("Polygon"===t.type){let s=t.arcs;s.forEach(t=>{this.#H(tv,tx,t,this.topoArcList,tS,t9)})}else if("MultiPolygon"===t.type){let i=t.arcs;i.forEach(t=>{t.forEach(t=>{this.#H(tv,tx,t,this.topoArcList,tS,t9)})})}else if("LineString"===t.type){let e=t.arcs;this.#H(tv,tx,e,this.topoArcList,tS,t9)}})}#H(tw,tk,tj,t0,tL,tT){let tC=!0;tw.beginPath(),tj.forEach(t=>{if(t>=0){let s=t0[t];for(let i=0;i<s.length;i++){let e=tk.x(s[i].lon,this.centerLon),h=tk.y(s[i].lat,this.centerLat);tC?(tw.moveTo(e,h),tC=!1):tw.lineTo(e,h)}}else{let r=t0[~t];for(let l=r.length-1;l>=0;l--){let a=tk.x(r[l].lon,this.centerLon),o=tk.y(r[l].lat,this.centerLat);tC?(tw.moveTo(a,o),tC=!1):tw.lineTo(a,o)}}}),tT&&tw.stroke(),tL&&tw.fill()}}"undefined"==typeof module?self.Trajs=t:module.exports=t}();